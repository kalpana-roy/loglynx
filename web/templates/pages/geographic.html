{{define "geographic.html"}}
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{{.Title}} - LogLynx</title>

    <!-- Favicon -->
    <link rel="icon" type="image/svg+xml" href="/static/images/favicon.svg">

    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">

    <!-- Font Awesome -->
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">

    <!-- DataTables CSS -->
    <link href="https://cdn.datatables.net/1.13.6/css/dataTables.bootstrap5.min.css" rel="stylesheet">

    <!-- Leaflet CSS -->
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"/>

    <!-- Leaflet MarkerCluster CSS -->
    <link rel="stylesheet" href="https://unpkg.com/leaflet.markercluster@1.5.3/dist/MarkerCluster.css"/>
    <link rel="stylesheet" href="https://unpkg.com/leaflet.markercluster@1.5.3/dist/MarkerCluster.Default.css"/>

    <!-- Custom CSS -->
    <link href="/static/css/theme.css" rel="stylesheet">
    <link href="/static/css/layout.css" rel="stylesheet">
    <link href="/static/css/charts.css" rel="stylesheet">
    <link href="/static/css/tooltip.css" rel="stylesheet">
    <link href="/static/css/geographic.css" rel="stylesheet">
</head>
<body>
    <div class="app-container">
        {{template "sidebar" .}}
        <div class="sidebar-overlay"></div>
        <div class="main-content">
            {{template "header" .}}
            <main class="page-content">
<div class="page-header">
    <div class="page-header-top">
        <div>
            <h2 class="page-title">
                <i class="fas fa-map-marked-alt"></i>
                Geographic Analytics
            </h2>
            <p class="page-description">Interactive world map, geographic distribution, and location intelligence</p>
        </div>
        <div class="page-actions">
            <button class="btn btn-outline btn-sm" onclick="exportGeoData()">
                <i class="fas fa-file-export"></i> Export Report
            </button>
            <button class="btn btn-outline btn-sm" onclick="location.reload()">
                <i class="fas fa-sync-alt"></i> Refresh
            </button>
        </div>
    </div>
</div>

<!-- Geographic Summary KPIs -->
<div class="grid grid-cols-4 mb-4">
    <div class="stat-card">
        <div class="stat-label">Countries</div>
        <div class="stat-value text-primary" id="totalCountries">0</div>
        <div class="stat-subtitle">Geographic reach</div>
    </div>

    <div class="stat-card">
        <div class="stat-label">Cities</div>
        <div class="stat-value text-info" id="totalCities">0</div>
        <div class="stat-subtitle">Urban centers</div>
    </div>

    <div class="stat-card">
        <div class="stat-label">Continents</div>
        <div class="stat-value text-success" id="totalContinents">0</div>
        <div class="stat-subtitle">Global coverage</div>
    </div>

    <div class="stat-card">
        <div class="stat-label">Top Country</div>
        <div class="stat-value text-warning" id="topCountry">-</div>
        <div class="stat-subtitle" id="topCountryHits">0 hits</div>
    </div>
</div>

<!-- Interactive World Map -->
<div class="card mb-4">
    <div class="card-header">
        <h5 class="card-title">
            <i class="fas fa-globe-americas"></i>
            Interactive World Map
            <span class="badge badge-live ms-2">LIVE</span>
        </h5>
        <div class="d-flex gap-2">
            <button class="btn btn-sm btn-outline" id="mapViewStreet">
                <i class="fas fa-map"></i> Street
            </button>
            <button class="btn btn-sm btn-outline active" id="mapViewSatellite">
                <i class="fas fa-satellite"></i> Dark
            </button>
            <button class="btn btn-sm btn-outline" id="toggleHeatmap">
                <i class="fas fa-fire"></i> Heatmap
            </button>
            <button class="btn btn-sm btn-outline" id="toggleClusters">
                <i class="fas fa-layer-group"></i> Clusters
            </button>
        </div>
    </div>
    <div class="card-body p-0">
        <div id="worldMap" style="height: 500px; width: 100%;"></div>
        <div id="mapLegend" class="p-3" style="background: var(--loglynx-card); border-top: 1px solid var(--border-color);">
            <div class="d-flex justify-content-between align-items-center">
                <div class="d-flex gap-3">
                    <div class="d-flex align-items-center gap-2">
                        <div style="width: 12px; height: 12px; background: #28a745; border-radius: 50%;"></div>
                        <small style="color: #FFFFFF;">Low Traffic (1-100)</small>
                    </div>
                    <div class="d-flex align-items-center gap-2">
                        <div style="width: 12px; height: 12px; background: #ffc107; border-radius: 50%;"></div>
                        <small style="color: #FFFFFF;">Medium Traffic (101-1000)</small>
                    </div>
                    <div class="d-flex align-items-center gap-2">
                        <div style="width: 12px; height: 12px; background: #F46319; border-radius: 50%;"></div>
                        <small style="color: #FFFFFF;">High Traffic (1001-10000)</small>
                    </div>
                    <div class="d-flex align-items-center gap-2">
                        <div style="width: 12px; height: 12px; background: #dc3545; border-radius: 50%;"></div>
                        <small style="color: #FFFFFF;">Very High Traffic (10000+)</small>
                    </div>
                </div>
                <div>
                    <span class="text-muted">Total Markers: </span>
                    <strong id="totalMarkers" style="color: #FFFFFF;">0</strong>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Geographic Distribution Charts -->
<div class="grid grid-cols-2 mb-4">
    <!-- Continent Distribution -->
    <div class="chart-container medium">
        <div class="chart-header">
            <h5 class="chart-title">
                <i class="fas fa-earth-americas"></i>
                Traffic by Continent
            </h5>
        </div>
        <canvas id="continentChart"></canvas>
    </div>

    <!-- Top Countries Bar Chart -->
    <div class="chart-container medium">
        <div class="chart-header">
            <h5 class="chart-title">
                <i class="fas fa-flag"></i>
                Top 10 Countries
            </h5>
        </div>
        <canvas id="topCountriesBarChart"></canvas>
    </div>
</div>

<!-- Detailed Country Analysis -->
<div class="card mb-4">
    <div class="card-header">
        <h5 class="card-title">
            <i class="fas fa-globe"></i>
            Country-Level Analysis
        </h5>
        <div class="d-flex gap-2">
            <select id="countryLimit" class="form-select form-select-sm" style="width: auto;">
                <option value="20">Top 20</option>
                <option value="50" selected>Top 50</option>
                <option value="100">Top 100</option>
                <option value="0">All Countries</option>
            </select>
            <button class="btn btn-sm btn-outline" onclick="exportCountryData()">
                <i class="fas fa-download"></i> Export
            </button>
        </div>
    </div>
    <div class="card-body">
        <div class="table-responsive">
            <table id="countryTable" class="table table-striped table-sm" style="width:100%">
                <thead>
                    <tr>
                        <th>Rank</th>
                        <th>Flag</th>
                        <th>Country</th>
                        <th>Country Code</th>
                        <th>Hits</th>
                        <th>Unique Visitors</th>
                        <th>Bandwidth</th>
                        <th>Avg Response</th>
                        <th>Market Share</th>
                    </tr>
                </thead>
                <tbody>
                    <!-- Populated by DataTables -->
                </tbody>
            </table>
        </div>
    </div>
</div>

<!-- City-Level Analysis -->
<div class="card mb-4">
    <div class="card-header">
        <h5 class="card-title">
            <i class="fas fa-city"></i>
            Top Cities Worldwide
        </h5>
        <button class="btn btn-sm btn-outline" onclick="exportCityData()">
            <i class="fas fa-download"></i> Export
        </button>
    </div>
    <div class="card-body">
        <div class="table-responsive">
            <table id="cityTable" class="table table-striped table-sm" style="width:100%">
                <thead>
                    <tr>
                        <th>Rank</th>
                        <th>City</th>
                        <th>Country</th>
                        <th>Latitude</th>
                        <th>Longitude</th>
                        <th>Hits</th>
                        <th>Bandwidth</th>
                        <th>Map</th>
                    </tr>
                </thead>
                <tbody>
                    <!-- Populated by DataTables -->
                </tbody>
            </table>
        </div>
    </div>
</div>

<!-- IP Geolocation Details -->
<div class="card mb-4">
    <div class="card-header">
        <h5 class="card-title">
            <i class="fas fa-network-wired"></i>
            IP Geolocation Details
        </h5>
        <button class="btn btn-sm btn-outline" onclick="exportIPGeoData()">
            <i class="fas fa-download"></i> Export
        </button>
    </div>
    <div class="card-body">
        <div class="table-responsive">
            <table id="ipGeoTable" class="table table-striped table-sm" style="width:100%">
                <thead>
                    <tr>
                        <th>IP Address</th>
                        <th>Country</th>
                        <th>City</th>
                        <th>Coordinates</th>
                        <th>ASN</th>
                        <th>Organization</th>
                        <th>Hits</th>
                        <th>Actions</th>
                    </tr>
                </thead>
                <tbody>
                    <!-- Populated by DataTables -->
                </tbody>
            </table>
        </div>
    </div>
</div>

<!-- ASN Geographic Distribution -->
<div class="card mb-4">
    <div class="card-header">
        <h5 class="card-title">
            <i class="fas fa-building"></i>
            ASN Geographic Distribution
        </h5>
        <button class="btn btn-sm btn-outline" onclick="exportASNGeoData()">
            <i class="fas fa-download"></i> Export
        </button>
    </div>
    <div class="card-body">
        <div class="table-responsive">
            <table class="table table-sm">
                <thead>
                    <tr>
                        <th>Rank</th>
                        <th>ASN</th>
                        <th>Organization</th>
                        <th>Primary Country</th>
                        <th>Countries Served</th>
                        <th>Hits</th>
                        <th>Bandwidth</th>
                    </tr>
                </thead>
                <tbody id="asnGeoTable">
                    <tr><td colspan="7" class="text-center text-muted">Loading...</td></tr>
                </tbody>
            </table>
        </div>
    </div>
</div>

<!-- Geographic Insights -->
<div class="grid grid-cols-3 mb-4">
    <div class="card">
        <div class="card-header">
            <h5 class="card-title">
                <i class="fas fa-chart-pie"></i>
                Geographic Diversity
            </h5>
        </div>
        <div class="card-body">
            <div class="mb-3">
                <small class="text-muted d-block mb-1">Countries with Traffic</small>
                <div class="d-flex justify-content-between">
                    <strong id="countriesWithTraffic">0</strong>
                    <span class="text-muted" id="countriesPercent">0%</span>
                </div>
                <div style="width: 100%; height: 6px; background: #1f1f21; border-radius: 3px; overflow: hidden; margin-top: 5px;">
                    <div id="countriesBar" style="width: 0%; height: 100%; background: #28a745; transition: width 0.5s;"></div>
                </div>
            </div>
            <div class="mb-3">
                <small class="text-muted d-block mb-1">Cities with Traffic</small>
                <div class="d-flex justify-content-between">
                    <strong id="citiesWithTraffic">0</strong>
                    <span class="text-muted">Urban centers</span>
                </div>
            </div>
            <div>
                <small class="text-muted d-block mb-1">Geographic Spread</small>
                <strong id="geoSpread">Global</strong>
            </div>
        </div>
    </div>

    <div class="card">
        <div class="card-header">
            <h5 class="card-title">
                <i class="fas fa-trophy"></i>
                Top Performing Regions
            </h5>
        </div>
        <div class="card-body">
            <div class="mb-3">
                <small class="text-muted d-block mb-1">Highest Traffic Country</small>
                <strong id="highestTrafficCountry">-</strong>
                <small class="text-muted d-block" id="highestTrafficHits">0 hits</small>
            </div>
            <div class="mb-3">
                <small class="text-muted d-block mb-1">Fastest Response Region</small>
                <strong id="fastestRegion">-</strong>
                <small class="text-muted d-block" id="fastestRegionTime">0ms avg</small>
            </div>
            <div>
                <small class="text-muted d-block mb-1">Most Active Timezone</small>
                <strong id="activeTimezone">UTC</strong>
            </div>
        </div>
    </div>

    <div class="card">
        <div class="card-header">
            <h5 class="card-title">
                <i class="fas fa-exclamation-triangle"></i>
                Geographic Alerts
            </h5>
        </div>
        <div class="card-body">
            <div class="mb-3">
                <div class="d-flex justify-content-between align-items-center">
                    <span><i class="fas fa-globe text-warning"></i> New Countries (24h)</span>
                    <span class="badge badge-warning" id="newCountries">0</span>
                </div>
            </div>
            <div class="mb-3">
                <div class="d-flex justify-content-between align-items-center">
                    <span><i class="fas fa-city text-info"></i> New Cities (24h)</span>
                    <span class="badge badge-info" id="newCities">0</span>
                </div>
            </div>
            <div>
                <div class="d-flex justify-content-between align-items-center">
                    <span><i class="fas fa-shield-alt text-success"></i> Trusted Regions</span>
                    <span class="badge badge-success" id="trustedRegions">0</span>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Coordinates Lookup Tool -->
<div class="card">
    <div class="card-header">
        <h5 class="card-title">
            <i class="fas fa-search-location"></i>
            Coordinates Lookup Tool
        </h5>
    </div>
    <div class="card-body">
        <div class="row">
            <div class="col-md-4">
                <label for="lookupIP" class="form-label">IP Address</label>
                <div class="input-group">
                    <input type="text" class="form-control" id="lookupIP" placeholder="Enter IP address">
                    <button class="btn btn-primary" onclick="lookupIPLocation()">
                        <i class="fas fa-search"></i> Lookup
                    </button>
                </div>
            </div>
            <div class="col-md-8">
                <div id="lookupResult" class="mt-3" style="display: none;">
                    <div class="alert alert-info">
                        <strong id="lookupResultIP"></strong>
                        <ul class="mb-0 mt-2">
                            <li>Country: <strong id="lookupCountry"></strong></li>
                            <li>City: <strong id="lookupCity"></strong></li>
                            <li>Coordinates: <strong id="lookupCoords"></strong></li>
                            <li>ASN: <strong id="lookupASN"></strong></li>
                            <li>Organization: <strong id="lookupOrg"></strong></li>
                        </ul>
                        <button class="btn btn-sm btn-primary mt-2" onclick="showOnMap()">
                            <i class="fas fa-map-marker-alt"></i> Show on Map
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
            </main>
            {{template "footer" .}}
        </div>
    </div>

    {{template "scripts-common" .}}

    <!-- Leaflet JS -->
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js" crossorigin="anonymous"></script>

    <!-- Leaflet MarkerCluster JS -->
    <script src="https://unpkg.com/leaflet.markercluster@1.5.3/dist/leaflet.markercluster.js"></script>

    <!-- Leaflet Heat JS -->
    <script src="https://unpkg.com/leaflet.heat@0.2.0/dist/leaflet-heat.js"></script>

    <script src="/static/js/pages/geographic.js"></script>
    <script src="/static/js/core/country-data.js"></script>
    <script>
        document.addEventListener('DOMContentLoaded', () => {
            LogLynxUtils.setActiveNavItem('geographic');
        });
    </script>
</body>
</html>
{{end}}
